<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/normolize.css">
    <link rel="stylesheet" href="css/style.css">
    
    <title>Document</title>
</head>
<body>
    <ul id="braceletSizeWrap">
        <li><h3>Размер браслета</h3></li>
        <li id="sizeRadio">
            <select name="sizeBracelet" id="sizeBracelet">
                <option value="20">14см</option>
                <option value="22">15см</option>
                <option value="23">16см</option>
                <option value="24">17см</option>
                <option value="25">18см</option>
                <option value="26">19см</option>
            </select>
        </li>
    </ul>
    <div style ="position: relative;" id="field">
    </div>
    <ul id="priceBox">
        <li id="price"></li>
        <!-- <li> руб.</li> -->
        <li id="PriceBtn">Заказать</li>
    </ul>
    <!-- <form id="tg">
        <input type="text" name="phone">
        <button type="submit">Заказать</button>
    </form> -->
    <div class="dropsWrap">
        <ul id="dropsField" style="display: none"></ul>
    </div>
    

    </div>
      <script src="js/drops.js"></script> <!-- подключение файла с бусинами -->
    <script>
        let braceletSize = 20;
        let beadsGrad = 18;
        let beadsSize = 0.127;
        document.getElementById('sizeBracelet').addEventListener('change', event => {
            console.log('ok');
            braceletSize = +event.target.value;
            switch (braceletSize) {
                case 20:
                beadsGrad =18;
                beadsSize = 0.127;
                break;
                case 22:
                beadsGrad =16.363636;
                beadsSize = 0.115;
                break;
                case 23:
                beadsGrad =15.652174;
                beadsSize = 0.112;
                break;
                case 24:
                beadsGrad =15;
                beadsSize = 0.105;
                break;
                case 25:
                beadsGrad =14.4;
                beadsSize = 0.103;
                break;
                case 26:
                beadsGrad =13.846154;
                beadsSize = 0.097;
                break;
            }
            buildBracelet ();
        })

        const priceBox = document.getElementById('priceBox') //== для размера букв
        const price = document.getElementById('price') //=блок вывода цены
        let priceChek = 0+' руб.';
        price.innerHTML = priceChek;
        const field = document.getElementById("field");
        // let widthWatch = document.querySelector("input").value; //ширина большого циферблата, от нее все рассчитывается
        let widthWatch;
        if (window.screen.width < 600) {
            widthWatch = window.screen.width;
            document.getElementById('priceBox').style.fontSize = window.screen.width/100*6+'px';
            document.getElementById('braceletSizeWrap').style.fontSize = window.screen.width/100*6+'px';

        } else {
            widthWatch = 600;
        }//ширина большого циферблата, от нее все рассчитывается
        // const ciferblat = document.createElement("div"); //большой который
        // ciferblat.classList.add("big");
        // ciferblat.style.width = widthWatch+'px'; //== эт его ширина
        // ciferblat.style.height = ciferblat.style.width;  //== она же высота
        // field.classList.add("big");
        field.style.width = widthWatch+'px'; //== эт его ширина
        field.style.height = field.style.width;  //== она же высота
        // field.appendChild(ciferblat);

        function getParam (whatArrow,width,clas) { //== работа со стрелками (не только, раскидывает круги)
            whatArrow.classList.add(clas); //== добавляем класс
            whatArrow.style.width = width+"px"; //== её длинна 45% от ширины циферблата
            field.appendChild(whatArrow); //== апендим
        }


        function buildBracelet () {
            const numbers = []; //== сюда будуут пушиться 12 положений маленьких циферблатов, их градусы (цикл ниже)
        // const cifry = [12,1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22] //== это на циферблат добавится
        
            let roundH = 0;
            for (let i =0; i<braceletSize; i++) { 
                numbers.push(roundH);
                roundH += beadsGrad;
            }

            const elementCount = field.childElementCount
            for (let v= 0; v<elementCount; v++) {
                document.getElementById('id'+v).remove();
            }

            for (let k= 0; k<braceletSize; k++) {
                 //== раскидываем циферблат с цифрами
                const smallRound = document.createElement("div");
                smallRound.addEventListener('click', openPolka)
                smallRound.id = "id"+k //== создаем маленький зеленый круг
                getParam(smallRound, widthWatch*beadsSize, "green"); //== настраиваем
                smallRound.style.height = smallRound.style.width; //==даем высотуу
                smallRound.dataset.price = 0;
                smallRound.dataset.name = 0;
                const radius = widthWatch*0.4; //== расстояние от центра циферблата
                const angle=parseFloat(numbers[k])/180*Math.PI; //== на какой угол раскидывать этот кружок
                const redCenterX=field.offsetLeft+field.offsetWidth/2; //== ципо центр большого циферблата по Х
                const redCenterY=0+field.offsetHeight/2; //== по У
                const greenCenterX=redCenterX+radius*Math.sin(angle); 
                const greenCenterY=redCenterY-radius*Math.cos(angle);
                smallRound.style.left= Math.round(greenCenterX-smallRound.offsetWidth/2)+'px';
                smallRound.style.top= Math.round(greenCenterY-smallRound.offsetHeight/2)+'px';
            }
        }
        buildBracelet ();
        
        const dropsField = document.getElementById('dropsField');
        // const dropsFieldUl = document.createElement('ul');
        // dropsField.appendChild(dropsFieldUl);
        for (let i = 0; i < drops.length; i ++) {  //создает в полке бусины
                const dropsBoxLi = document.createElement('li');
                const dropsBoxWrapUl = document.createElement('ul');
                const dropsBoxImgLi = document.createElement('li');
                const dropsBoxNameLi = document.createElement('li');
                dropsBoxImgLi.style.width = widthWatch*0.15+'px';
                dropsBoxImgLi.style.height = widthWatch*0.15+'px';
                // dropsIxBox.classList.add('dropsIxBox');
                dropsBoxImgLi.dataset.price = drops[i].price;
                dropsBoxImgLi.dataset.name = drops[i].name;
                dropsBoxImgLi.style.background = drops[i].background;
                dropsBoxImgLi.style.backgroundSize = 'contain'
                // console.log(dropsIxBox.style.background)
                dropsBoxImgLi.style.borderRadius = 50+'px';
                dropsBoxImgLi.addEventListener('click', doDrops);

                dropsBoxNameLi.appendChild(document.createTextNode(drops[i].name));
                dropsBoxWrapUl.appendChild(dropsBoxImgLi);
                dropsBoxWrapUl.appendChild(dropsBoxNameLi);

                dropsBoxLi.appendChild(dropsBoxWrapUl);
                dropsField.appendChild(dropsBoxLi);



                // const dropsName = document.createElement('li');
                

                // dropsField.appendChild(dropsIxBox);
                

            }
        function doDrops (event) { //==фукция когда нажал на одну бусину и она применилась на браслет
            const curDrops = document.getElementById(CurrentDropsPlaceId);
            curDrops.style.background = event.target.style.background;
            curDrops.dataset.price = event.target.getAttribute('data-price');
            curDrops.dataset.name = event.target.getAttribute('data-name');
            // curDrops.setAttribute
            getPrice()
        }

        let CurrentDropsPlaceId;
        function openPolka (event) { //===тень на активном
            for (let i = 0; i < braceletSize; i ++) {
                const findDrops = document.getElementById('id'+i);
                findDrops.classList.remove('shadawOn');
                findDrops.classList.add('shadowOff');
                // findDrops.dataset.price = event.target.getAttribute('data-price');
            }
            event.target.classList.add('shadawOn');
            CurrentDropsPlaceId = event.target.id;
            dropsField.style.display = "flex";
        }
        

        ///===== цена
        function getPrice () {
            priceChek = 0;
            for (let i = 0; i < braceletSize; i ++) {
                const findBraceletPriceChange = document.getElementById('id'+i);
                console.log(findBraceletPriceChange.getAttribute('data-price'));
                priceChek += +(findBraceletPriceChange.getAttribute('data-price'));
                price.innerHTML = priceChek+' руб.';
            }
            if (priceChek > 0) {
                document.getElementById('PriceBtn').classList.toggle('active_btn')
            }
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <!-- <script>
        const token =  '5900567011:AAFaVKV4bQYVVqpNKnDFaJ-t0-E23v-uuOE';
        const chatId = '-1001876046498';
        const URI_API = `https://api.telegram.org/bot${ token }/sendMessage`;

        document.getElementById('tg').addEventListener('submit', function(e) {
            e.preventDefault();
            let message = `<b>заявка с сайта</b>\n`;
            for (let i = 0; i < 22; i ++) {
                message += ` ${document.getElementById('id'+i).id}: ${document.getElementById('id'+i).getAttribute('data-name')}\n`
            }
            message += `цена браслета: ${priceChek}`

            axios.post(URI_API, {
                chat_id: chatId,
                parse_mode: 'html',
                text: message
            })
        })


    </script> -->
</body>
</html>